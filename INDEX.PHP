<?php
require_once 'config/db.php';
require_once 'logic/carrito.php';
require_once 'logic/vuelo.php';
require_once 'logic/hotel.php';
require_once 'logic/consulta.php';
?>
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Agencia de Viajes "Escapate.cl"</title>
  <link rel="stylesheet" href="../public/assets/style.css">
  <script src="../public/assets/script.js"></script>
</head>
<body>
  <h1>Agencia de Viajes "Escapate.cl"</h1>

  <div class="notificacion">üéâ ¬°Solo por hoy! 30% de descuento en paquetes a Torres del Paine.</div>

  <h2>Registra tu intenci√≥n de viaje</h2>
  <form method="POST" onsubmit="return validarPaquete()">
    <input type="hidden" name="agregar" value="1">
    <label>Nombre del Hotel:</label><input type="text" name="hotel" required>
    <label>Ciudad:</label><input type="text" name="ciudad" required>
    <label>Pa√≠s:</label><input type="text" name="pais" required>
    <label>Fecha de Viaje:</label><input type="date" name="fecha" required>
    <label>Duraci√≥n (en d√≠as):</label><input type="number" name="duracion" required>
    <button type="submit">Enviar</button>
  </form>

  <h2>Registrar Vuelo</h2>
  <form method="POST" onsubmit="return validarFormularioVuelo()">
    <input type="hidden" name="insertar_vuelo" value="1">
    <label>Origen:</label><input type="text" name="origen" required>
    <label>Destino:</label><input type="text" name="destino" required>
    <label>Fecha:</label><input type="date" name="fecha_vuelo" required>
    <label>Plazas disponibles:</label><input type="number" name="plazas" required>
    <label>Precio:</label><input type="number" name="precio" required>
    <button type="submit">Registrar Vuelo</button>
  </form>

  <h2>Registrar Hotel</h2>
  <form method="POST">
    <input type="hidden" name="insertar_hotel" value="1">
    <label>Nombre:</label><input type="text" name="nombre" required>
    <label>Ubicaci√≥n:</label><input type="text" name="ubicacion" required>
    <label>Habitaciones disponibles:</label><input type="number" name="habitaciones" required>
    <label>Tarifa por noche:</label><input type="number" name="tarifa" required>
    <button type="submit">Registrar Hotel</button>
  </form>

<h2>Buscar Vuelos</h2>
<form method="POST">
  <input type="hidden" name="buscar_vuelos" value="1">
  <label>Origen:</label><input type="text" name="origen_buscar">
  <label>Destino:</label><input type="text" name="destino_buscar">
  <button type="submit">Buscar</button>
</form>

<?php if (!empty($resultados_busqueda)): ?>
  <h3>Resultados encontrados:</h3>
  <ul>
    <?php foreach ($resultados_busqueda as $vuelo): ?>
      <li> <?= htmlspecialchars($vuelo['origen']) ?> ‚Üí <?= htmlspecialchars($vuelo['destino']) ?> | Fecha: <?= htmlspecialchars($vuelo['fecha']) ?> | $<?= htmlspecialchars($vuelo['precio']) ?></li>
    <?php endforeach; ?>
  </ul>
<?php endif; ?>

  <?php if (!empty($_SESSION['carrito'])): ?>
    <h3>Carrito de Viajes:</h3>
    <ul>
      <?php foreach ($_SESSION['carrito'] as $item): ?>
        <li>Destino: <?= htmlspecialchars($item['ciudad']) ?>, <?= htmlspecialchars($item['pais']) ?> | Hotel: <?= htmlspecialchars($item['hotel']) ?> | Fecha: <?= htmlspecialchars($item['fecha']) ?> | <?= htmlspecialchars($item['duracion']) ?> d√≠as</li>
      <?php endforeach; ?>
    </ul>
    <form method="POST">
      <button type="submit" name="vaciar">Vaciar Carrito</button>
    </form>
  <?php else: ?>
    <p>No hay paquetes en tu carrito a√∫n.</p>
  <?php endif; ?>

  <h2>Hoteles con m√°s de 2 reservas</h2>
  <?php foreach ($reservas_hoteles as $fila): ?>
    <div class="notificacion">
      Hotel: <?= htmlspecialchars($fila['nombre']) ?> - Reservas: <?= htmlspecialchars($fila['total_reservas']) ?>
    </div>
  <?php endforeach; ?>
</body>
</html>
